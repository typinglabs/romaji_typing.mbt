# タスク管理

## Backlog

### 機能

- [ ] 打トレクローン
  - [ ] 文章が入り切らない場合にスクロールしたい→TODO:
  - [ ] 最高スコア、最小スコアをセッションに保存できるようにする

### 内部品質

- 自動でpublishする仕組みを作る
- グラフの構築のコードが特に適当なので、テスト書きながらリファクタリングする
- パフォーマンスの改善も期待できるかも
- Codexにコミットやpush、Pull Requestの作成をやってもらう

## In-Progress

- [ ] ドキュメンテーションコメントを書く
- [ ] READMEを更新する

## Done

- [x] 単語末尾の「ん」を `n` 1回で入力できるオプションを追加する
  - [x] `TypingOptions` を追加して API を options 必須にする
  - [x] `kana_graph` に末尾 `ん` 特例遷移を追加する
  - [x] テストを追加・更新する
- [x] 漢字を含むワードを扱う機能を実装を、ライブラリ側に移植する（exampleに実装済み）
- [x] ライブラリインポートのパスが汚い（typinglabs/roman_input/src）ので、方法を考える
  - できればtypinglabs/roman_inputにしたいけど…
  - `moon.mod.json`に`"source": "src"`を指定すればいいっぽい
- [x] CIを用意して、テストを実行する
- [x] 公開する
- [x] ショートカットをつける
  - [x] Escでホームに戻る
  - [x] ホーム画面でEnterでスタートする
- [x] 画面ごとに、データとロジックを書いていく
  - [x] 開始画面
    - [x] スタートボタンをクリックした時、ゲームを開始する
  - [x] カウントダウン画面
    - [x] 1秒経過するごとに、カウントダウンを1ずつ減らす
    - [x] 0になった時、タイピングゲームを開始する
  - [x] タイピング画面
    - [x] 1秒経過するごとに、カウントダウンを1ずつ減らす
    - [x] 0になったら終了画面に移動する
    - [x] キー入力のハンドリングを行う
    - [x] 複数ワードに対応する
    - [x] 漢字を含んでいるワードに対応する
      - 丸投げしました、仕事が早い
    - [x] 苦手キーのデータを保存する
  - [x] 終了画面
    - [x] 必要なデータを表示する
    - [x] ~~リスタート~~戻るをクリックした時に最初のページに戻る
- [x] PencilでUIモックアップを作る
- [x] プロジェクトの雛形を作成する
- [x] PencilのモックアップをHTML + Tailwindで出力してもらう
  - なんかめっちゃ苦戦した、ちゃんとした方法を調べておきたい
- [x] 静的ファイルをRabbit-TEAのViewに書き直す

## メモ

モジュールの分割がいまいちピンとこないので、整理する。

画面ごとに分けるのがいいのかなと思っている。

ModelやViewはそんなに難しくない。ModelはEnumを作って、画面とその画面に必要なデータを定義すればよい。

Viewは、そのModelに応じて出し分ければ良い。

難しいのはupdate。`(msg, model) -> (cmd, model)`っていうシグネチャになっているから、これをどう分割、合成するかが課題。

今のタイピングゲームのロジックをこれに合わせて整理すると、こんな感じになるだろうか。

- スタートをクリック -> (1秒後にカウントを進める, カウントダウン画面)
- カウントダウンのカウントを進める ->
  - if カウント > 1 then (1秒後にカウントを進める, カウント - 1)
  - else ([キーボードイベントハンドラを登録する, タイマーを開始する], ゲーム画面)
- ゲームでキー入力をした -> (なし, 正誤に応じてデータを更新する)
- ゲームのタイマーが進んだ ->
  - if カウント > 1 then (なし, 残り時間 - 1)
  - else (キーボードイベントハンドラを削除する, リザルト画面)
- トップへ戻るをクリックした -> (なし, ホームへ戻る)

上記のロジックを、できるだけ素直に表現したコードにしたい。

画面ごとにupdateロジックを隠蔽しようにも、画面をまたいでいるものが結構あるので、そこをどうするべきかがわからない。

具体的にいうと、スタートからカウントダウンへの移動、カウントダウンからゲームへの移動、ゲームからリザルトへの移動、リザルトからスタートへの移動。

- Q1. 画面をまたぐロジックをどう書くべきか?
  - @countdown.update: (CountdownMsg, CountdownModel) -> (Cmd, CountdownModel | GameModel)みたいな型でupdateを実装する？

---

漢字を含んでいるワードのタイピングについて。

ひらがなを使って正誤判定するところは同じだけれど、ひらがながどの漢字に対応しているかを把握して、漢字をどこまで打ったかを把握する必要がある。

具体的には、「作成する」だと、作=さく、成=せい、みたいなデータを持っておく必要がある。

今はひらがなだけなので、作ったライブラリをそのまま使えるけど、

それをラップして`{ typed_kanji_index: 2 }`みたいに、どこまで入力したかを分かるようにする。

---

打鍵トレーナーのクローンについて

[打鍵トレーナー（高速タイピング）](http://typing.tsurizamurai.com/daken_010/type.cgi)

- ランキング等は無しでOK。タイピングできるだけ。
- 打鍵数、ミス数、残り時間の3つを表示する
- 最高記録と最低記録
- Enterでスタート、ESCで終了

![alt text](image.png)
